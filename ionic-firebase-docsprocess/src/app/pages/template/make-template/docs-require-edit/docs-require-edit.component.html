<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-button color="medium" (click)="cancel()">Cancelar</ion-button>
    </ion-buttons>
    <ion-title>Documento Necessário</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="confirm()" [strong]="true">Confirmar</ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>
<ion-content class="ion-padding">

  <ion-list lines="none">
    <form [formGroup]="form">
      <ion-item>
        <ion-label position="stacked">Nome</ion-label>
        <ion-input type="name" formControlName="name"></ion-input>
      </ion-item>
      <div>
        <div *ngFor="let validation of validations.name">
          <div class="error-message"
            *ngIf="form.get('name').hasError(validation.type) && (form.get('name').dirty || form.get('name').touched)">
            <span>{{ validation.message }}</span>
          </div>  
        </div>
      </div>
      <ion-item>
        <ion-label position="stacked">Descrição</ion-label>
        <ion-input type="description" formControlName="description"></ion-input>
      </ion-item>
      <input type="file" class="file-input" (change)="onFileSelected($event)" #fileUpload>

      <div class="dropzone" dropzone (hovered)="toggleHover($event)" (dropped)="onDrop($event)"
        [class.hovering]="isHovering">

        <div *ngIf="!requiredDoc.urlFile">

          <h3 class="text-center">Selecione um arquivo</h3>
          <p>Arraste e solte seu arquivo, ou
            <a color="medium" (click)="fileUpload.click()"> clique aqui </a> para selecionar.
          </p>
        </div>

        <div *ngIf="requiredDoc.urlFile && requiredDoc.extension != 'pdf'" (click)="fileUpload.click()"
          class="position-absolute top-50 start-50 translate-middle">
          <img class="img-doc" [src]="requiredDoc.urlFile || ''" />
        </div>

        <pdf-viewer *ngIf="requiredDoc.urlFile && requiredDoc.extension == 'pdf'" [src]="requiredDoc.urlFile" [render-text]="true"
          [original-size]="false" style="width: 100%; height: 100%">
          <pdf-viewer [src]="pdfSrc" [(page)]="page" [rotation]="rotation" [original-size]="originalSize"
            [fit-to-page]="fitToPage" (after-load-complete)="afterLoadComplete($event)" [zoom]="zoom"
            [show-all]="showAll" [stick-to-page]="stickToPage" [render-text]="renderText"
            [external-link-target]="'blank'" [autoresize]="autoresize" (error)="onError($event)"
            (on-progress)="onProgress($event)" (page-rendered)="pageRendered($event)"></pdf-viewer>
        </pdf-viewer>

      </div>

      <ion-progress-bar [value]="percent/100" *ngIf="progress | async as percent"></ion-progress-bar>
    </form>
  </ion-list>
  <div class="ion-text-center ion-padding">
    <ion-button (click)="excluir()" color="danger" role="link">
      Excluir
      <ion-icon name="trash-outline"></ion-icon>    
    </ion-button>
  </div>
</ion-content>